<!DOCTYPE html>
<html>
<body>

<button onclick="post()">Create Post</button>

<button onclick="getPosts()">Get NearMe posts</button>

<p id="demo"></p>

<script>
var x = document.getElementById("demo");

function post() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(createPost);
  } else {
    x.innerHTML = "Geolocation is not supported by this browser.";
  }
}

function createPost(position) {
  var data = {
    comment: "helloworld",
    latitude: position.coords.latitude,
    longitude:  position.coords.longitude
  };

  var json = JSON.stringify(data);

  var xhr = new XMLHttpRequest();
  xhr.open("POST", "http://localhost:9000/posts", true);
  xhr.setRequestHeader('Content-Type', 'application/json');
  xhr.send(json);
  x.innerHTML = "Post Created";
}

function getPosts() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(getNearMePosts);
  } else {
    x.innerHTML = "Geolocation is not supported by this browser.";
  }
}

function getNearMePosts(position) {
  var data = {
    latitude: position.coords.latitude,
    longitude:  position.coords.longitude
  };

  var json = JSON.stringify(data);

 const fetchPromise = fetch("http://localhost:9000/posts/nearMe", {
    method: "post",
    headers: {
      'Accept': 'application/json',
      'Content-Type': 'application/json'
    },
    body: json
  })

fetchPromise.then(response => {
  return response.json();
}).then(data => {
   x.innerHTML = JSON.stringify(data);
});
}
</script>

</body>
</html>

